/* ==========================================================================
   DASHBOARD v3.1 MOBILE-FIRST THEME (refined)
   ========================================================================== *
   * Preserves v3 spacing & look.
   * Adds safe-area insets, hard no-repeat background, and mobile overflow fixes.
   * Adds edit/view utility classes so modules can toggle cleanly (no forced show).
   * Ensures form controls stay hidden unless JS or .is-editing reveals them.
   * Minimal !important usage; respects module inline styles.
   ========================================================================== */

/* --------------------------------------------------------------------------
   Design Tokens
   -------------------------------------------------------------------------- */
:root {
  --brand:            #1e90ff;
  --brand-hover:      #4aa8ff;
  --brand-focus-ring: rgba(30,144,255,.6);

  --success:          #00c853;
  --success-bg:       rgba(0,200,83,.15);
  --warning:          #ffb300;
  --warning-bg:       rgba(255,179,0,.15);
  --danger:           #ff5252;
  --danger-hover:     #ff1744;
  --danger-bg:        rgba(255,82,82,.15);
  --info:             #82caff;

  --bg-page-a:        #0f1117;
  --bg-page-b:        #1a1c24;
  --bg-card:          rgba(26,28,36,.75);
  --bg-card-solid:    #1b1d25;
  --bg-card-hover:    rgba(26,28,36,.95);

  --border-color:     rgba(255,255,255,.08);
  --border-strong:    rgba(255,255,255,.18);

  --text-hi:          #ffffff;
  --text-med:         #e2e8f0;
  --text-lo:          #a0aec0;
  --text-muted:       #718096;
  --text-invert:      #0f1117;

  --table-stripe:     rgba(255,255,255,.03);

  --radius-sm:        4px;
  --radius-md:        8px;
  --radius-lg:        16px;
  --radius-xl:        20px;

  /* Spacing (mobile-first fluid) */
  --space-2xs: clamp(2px, .25vw, 4px);
  --space-xs:  clamp(4px, .5vw, 8px);
  --space-sm:  clamp(8px, 1vw, 12px);
  --space-md:  clamp(16px, 2vw, 24px);
  --space-lg:  clamp(24px, 4vw, 40px);
  --space-xl:  clamp(32px, 6vw, 64px);

  /* Type scale */
  --fs-2xs: clamp(.7rem, 1.5vw, .75rem);
  --fs-xs:  clamp(.8rem, 1.8vw, .85rem);
  --fs-sm:  clamp(.9rem, 2vw, .95rem);
  --fs-md:  clamp(1rem, 2.5vw, 1.05rem);
  --fs-lg:  clamp(1.2rem, 3.5vw, 1.4rem);
  --fs-xl:  clamp(1.6rem, 5vw, 1.75rem);
  --fs-xxl: clamp(2rem, 7vw, 2.5rem);

  --z-header: 100;
  --z-modal:  1000;

  --dur-fast: .12s;
  --dur-med:  .25s;
  --dur-slow: .4s;
  --ease-out: cubic-bezier(.25,.8,.25,1);
  --ease-in:  cubic-bezier(.42,0,1,1);
  --ease-io:  cubic-bezier(.42,0,.58,1);

  --shadow-card:   0 4px 12px rgba(0,0,0,.6);
  --shadow-card-h: 0 8px 24px rgba(0,0,0,.8);
  --shadow-btn:    0 4px 14px rgba(30,144,255,.4);
  --shadow-btn-h:  0 6px 20px rgba(30,144,255,.6);
  --shadow-danger: 0 4px 14px rgba(255,82,82,.4);
  --shadow-success:0 4px 14px rgba(0,200,83,.4);
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  :root { --dur-fast:0ms; --dur-med:0ms; --dur-slow:0ms; }
  *{transition:none!important;animation:none!important;}
}

/* ==========================================================================
   Base / Reset Extensions
   ========================================================================== */
*{box-sizing:border-box;margin:0;padding:0;}
html,body{
  height:100%;
  min-height:100%;
  background:linear-gradient(135deg,var(--bg-page-a) 0%,var(--bg-page-b) 100%) no-repeat;
  background-size:cover;
  background-attachment:scroll; /* change to fixed if you prefer parallax */
  color:var(--text-med);
  -webkit-text-size-adjust:100%;
  text-size-adjust:100%;
  max-width:100%;
  overflow-x:hidden;
}
body{
  font-family:'Segoe UI','SF Pro',Arial,sans-serif;
  /* Safe-area + bottom pad */
  padding-top:calc(env(safe-area-inset-top,0px) + var(--space-sm));
  padding-bottom:calc(env(safe-area-inset-bottom,0px) + var(--space-xl));
  padding-left:5%;
  padding-right:5%;
  font-size:var(--fs-md);
  line-height:1.4;
}
img,svg,video,canvas{max-width:100%;height:auto;display:block;}
button{font-family:inherit;font-size:inherit;line-height:inherit;}
a{color:var(--brand);text-decoration:none;}
a:hover{text-decoration:underline;}

/* Scrollbars */
::-webkit-scrollbar{width:10px;height:10px;}
::-webkit-scrollbar-track{background:rgba(255,255,255,.05);}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.25);border-radius:5px;}
::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.4);}

/* ==========================================================================
   Header
   ========================================================================== */
.admin-header{
  position:sticky;
  top:0;
  z-index:var(--z-header);
  display:flex;
  justify-content:space-between;
  align-items:center;
  width:100%;
  margin-left:auto;
  margin-right:auto;
  padding:var(--space-sm) 0;
  background:rgba(26,28,36,.65);
  backdrop-filter:saturate(180%) blur(12px);
  border-bottom:1px solid var(--border-color);
}
.admin-header h2{
  margin:0;
  font-size:var(--fs-xl);
  font-weight:700;
  color:var(--text-hi);
}
.admin-header button{
  padding:var(--space-xs) var(--space-md);
  border-radius:var(--radius-md);
  background:var(--brand);
  color:var(--text-hi);
  font-weight:600;
  border:none;
  cursor:pointer;
  box-shadow:var(--shadow-btn);
  transition:box-shadow var(--dur-med) var(--ease-out);
}
.admin-header button:hover{box-shadow:var(--shadow-btn-h);}

/* Logout */
#logoutBtn{
  background:rgba(255,255,255,.1);
  color:var(--text-hi);
  border:1px solid rgba(255,255,255,.3);
  padding:var(--space-xs) var(--space-md);
  font-size:var(--fs-sm);
  border-radius:var(--radius-md);
  cursor:pointer;
  transition:background var(--dur-med) var(--ease-out),transform var(--dur-fast) var(--ease-out);
}
#logoutBtn:hover{background:rgba(255,255,255,.2);transform:translateY(-1px);}

/* ==========================================================================
   Main Content Grid
   ========================================================================== */
#adminApp{
  width:100%;
  max-width:100%;
  margin:var(--space-lg) auto;
  padding:0;
  display:grid;
  grid-template-columns:1fr;
  gap:var(--space-lg);
}
@media (min-width:768px){
  #adminApp{max-width:90%;gap:var(--space-xl);}
}
@media (min-width:1200px){
  #adminApp{max-width:1200px;}
  /* opt-in for 2-col: uncomment if desired */
  /* #adminApp{grid-template-columns:1fr 1fr;} */
  /* #adminApp>.admin-section.section-span-2{grid-column:span 2;} */
}

/* ==========================================================================
   Section Card
   ========================================================================== */
.admin-section{
  position:relative;
  width:100%;
  background:var(--bg-card);
  border:1px solid var(--border-color);
  border-radius:var(--radius-xl);
  padding:clamp(16px,5vw,32px);
  box-shadow:var(--shadow-card);
  backdrop-filter:blur(12px) saturate(180%);
  transition:box-shadow var(--dur-med) var(--ease-out),background var(--dur-med) var(--ease-out);
}
.admin-section:hover{box-shadow:var(--shadow-card-h);background:var(--bg-card-hover);}
.admin-section h2,.section-title{
  font-size:var(--fs-lg);
  font-weight:700;
  color:var(--text-hi);
  margin-bottom:var(--space-md);
}

/* Collapsible (opt-in) */
.admin-section.collapsible>.section-header{
  display:flex;justify-content:space-between;align-items:center;cursor:pointer;user-select:none;
}
.admin-section.collapsible[data-open="false"]>*:not(.section-header){display:none;}

/* ==========================================================================
   Inputs
   ========================================================================== */
input,select,textarea{
  width:100%;
  border-radius:var(--radius-md);
  border:1px solid var(--border-color);
  padding:var(--space-xs) var(--space-sm);
  font-size:var(--fs-md);
  background:rgba(255,255,255,.06);
  color:var(--text-med);
  transition:border var(--dur-fast) var(--ease-out),background var(--dur-fast) var(--ease-out);
}
input:focus,select:focus,textarea:focus{
  outline:none;
  border-color:var(--brand);
  background:rgba(255,255,255,.1);
  box-shadow:0 0 0 2px var(--brand-focus-ring);
}

/* iOS zoom prevention: ensure tap targets >=16px */
@media (max-width:600px){
  input,select,textarea,button,.btn,.gfield{font-size:16px!important;line-height:1.2;}
}

/* ==========================================================================
   Buttons
   ========================================================================== */
button,.btn,.login-btn{
  border:none;
  border-radius:var(--radius-md);
  padding:var(--space-sm) var(--space-md);
  font-weight:600;
  cursor:pointer;
  line-height:1.2;
  transition:transform var(--dur-fast) var(--ease-out),box-shadow var(--dur-fast) var(--ease-out),background var(--dur-fast) var(--ease-out);
}
.btn-sm{padding:var(--space-xs) var(--space-sm);font-size:var(--fs-sm);}
.btn-lg{padding:var(--space-md) var(--space-lg);font-size:var(--fs-md);}

.btn-primary{background:var(--brand);color:var(--text-hi);box-shadow:var(--shadow-btn);}
.btn-primary:hover{background:var(--brand-hover);box-shadow:var(--shadow-btn-h);}

.btn-secondary{background:rgba(255,255,255,.15);color:var(--text-med);}
.btn-secondary:hover{background:rgba(255,255,255,.25);}

.btn-success{background:var(--success);color:var(--text-hi);box-shadow:var(--shadow-success);}
.btn-success:hover{filter:brightness(1.1);}

.btn-danger{background:var(--danger);color:var(--text-hi);box-shadow:var(--shadow-danger);}
.btn-danger:hover{background:var(--danger-hover);}

.btn-ghost{background:transparent;color:var(--brand);}
.btn-ghost:hover{background:rgba(30,144,255,.15);}

/* Make button stacks friendly on small screens */
@media (max-width:480px){
  .btn-responsive,
  .user-card-actions button,
  .review-controls button,
  .guest-card .guest-edit-form button,
  .guest-forms-table td button,
  .store-add button{
    width:100%;
    margin-top:var(--space-xs);
  }
  .guest-forms-table td button:first-child{margin-top:0;}
}

/* ==========================================================================
   Role Badges
   ========================================================================== */
.role-badge{
  display:inline-block;
  padding:2px 10px;
  font-size:var(--fs-xs);
  font-weight:600;
  border-radius:999px;
  line-height:1.2;
  box-shadow:0 0 0 1px var(--border-color) inset;
  vertical-align:middle;
  white-space:nowrap;
}
.role-admin{background:var(--brand);color:var(--text-hi);}
.role-dm{background:rgba(60,120,255,.8);color:#fff;}
.role-lead{background:rgba(30,200,120,.8);color:#fff;}
.role-me{background:rgba(180,180,200,.4);color:#fff;}
.role-guest{background:rgba(180,180,200,.5);color:var(--text-med);}

/* ==========================================================================
   Tables (Global)
   ========================================================================== */
.table-responsive-wrapper,
.guest-forms-table-wrap,
.store-table-wrap{
  width:100%;
  max-width:100%;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:var(--fs-sm);
}
th,td{
  padding:var(--space-sm);
  border-bottom:1px solid var(--border-color);
  text-align:left;
  white-space:nowrap;
}
th{color:var(--text-hi);font-weight:600;}
td{color:var(--text-med);}
tr:nth-child(odd){background:var(--table-stripe);}
td:last-child{text-align:right;}

/* Allow wrapping on narrow viewports */
@media (max-width:640px){
  th,td{white-space:normal;overflow-wrap:anywhere;word-break:break-word;}
}

/* Stackable tables (opt-in via .table-stackable) */
@media (max-width:600px){
  .table-stackable,
  .table-stackable thead,
  .table-stackable tbody,
  .table-stackable tr,
  .table-stackable th,
  .table-stackable td{
    display:block;
    width:100%;
  }
  .table-stackable thead{display:none;}
  .table-stackable tr{
    margin-bottom:var(--space-md);
    padding:var(--space-md);
    border:1px solid var(--border-color);
    border-radius:var(--radius-lg);
    background:var(--bg-card-hover);
    box-shadow:var(--shadow-card);
  }
  .table-stackable td{
    padding:var(--space-xs) 0;
    border:none;
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:var(--space-sm);
  }
  .table-stackable td::before{
    content:attr(data-label);
    font-weight:600;
    color:var(--text-hi);
    flex:0 0 auto;
  }
  .table-stackable td:last-child{
    justify-content:flex-start;
    flex-wrap:wrap;
    margin-top:var(--space-xs);
    text-align:left;
  }
}

/* ==========================================================================
   Stores Section
   ========================================================================== */
.stores-section{margin-bottom:var(--space-lg);}
.store-add{
  display:flex;
  gap:var(--space-sm);
  align-items:flex-start;
  width:100%;
  margin-top:var(--space-sm);
}
.store-add input{flex:1;}
@media (max-width:600px){
  .store-add{flex-direction:column;}
  .store-add input,.store-add button{width:100%;}
}

/* ==========================================================================
   Users Section
   ========================================================================== */
.users-section .users-container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(min(300px,100%),1fr));
  gap:var(--space-lg);
  width:100%;
}
.user-card{
  background:var(--bg-card);
  border:1px solid var(--border-color);
  border-radius:var(--radius-lg);
  padding:var(--space-lg);
  box-shadow:var(--shadow-card);
  transition:box-shadow var(--dur-med) var(--ease-out),background var(--dur-med) var(--ease-out);
  width:100%;
}
.user-card:hover{box-shadow:var(--shadow-card-h);background:var(--bg-card-hover);}
.user-card-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:var(--space-md);
  gap:var(--space-sm);
  flex-wrap:wrap;
}
.user-name{font-size:var(--fs-md);font-weight:700;color:var(--text-hi);}
.user-email{font-size:var(--fs-sm);color:var(--text-muted);overflow-wrap:anywhere;}
.user-card-info{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:var(--space-xs) var(--space-md);
  margin-bottom:var(--space-md);
  color:var(--text-med);
  font-size:var(--fs-sm);
}
.user-card-info b{color:var(--text-hi);}
.user-card-actions{
  display:grid;
  grid-template-columns:1fr auto;
  gap:var(--space-sm);
  align-items:start;
  width:100%;
}
@media (max-width:600px){
  .user-card-actions{grid-template-columns:1fr;width:100%;}
  .user-card-actions select,.user-card-actions button{width:100%;}
  .user-card-info{grid-template-columns:1fr;}
}

/* ==========================================================================
   Reviews Section
   ========================================================================== */
.reviews-section h2{margin-bottom:var(--space-md);}
.review-controls{
  display:flex;
  gap:var(--space-sm);
  margin-bottom:var(--space-md);
  flex-wrap:wrap;
  justify-content:flex-end;
  width:100%;
}
.reviews-container{
  display:grid;
  gap:var(--space-md);
  width:100%;
}
.review-card{
  background:var(--bg-card);
  border:1px solid var(--border-color);
  border-radius:var(--radius-lg);
  padding:var(--space-lg);
  box-shadow:var(--shadow-card);
  transition:box-shadow var(--dur-med) var(--ease-out),background var(--dur-med) var(--ease-out);
  width:100%;
}
.review-card:hover{box-shadow:var(--shadow-card-h);background:var(--bg-card-hover);}
.review-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:var(--space-sm);
  gap:var(--space-sm);
  flex-wrap:wrap;
  width:100%;
}
.review-header .left{
  display:flex;
  align-items:center;
  gap:var(--space-xs);
}
.review-star{font-size:1.2rem;color:gold;cursor:pointer;transition:transform var(--dur-fast) var(--ease-out);}
.review-star.inactive{color:rgba(255,255,255,.3);}
.review-star:hover{transform:scale(1.1);}
.review-header .info{font-size:var(--fs-sm);color:var(--text-med);}
.review-header .info b{color:var(--text-hi);}
.review-rating{margin-bottom:var(--space-sm);font-size:var(--fs-md);color:gold;}
.review-comment{font-size:var(--fs-md);line-height:1.5;color:var(--text-med);margin-bottom:var(--space-md);}
.review-meta{
  display:flex;
  flex-wrap:wrap;
  gap:var(--space-md);
  font-size: