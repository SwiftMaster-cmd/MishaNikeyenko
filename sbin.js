


(function(){if(window.__sbinOverlay)return;let d=JSON.parse(localStorage.getItem("sbinData")||"{}"),activeTopic=d.activeTopic||"Default",active=d.topics?.[activeTopic]||{s:"",b:"",i:"",n:""},editing=false,view="main",editNames=false,nameScrollOffset=0;if(!d.topics)d.topics={"Default":active};if(!d.names)d.names=[];function save(){localStorage.setItem("sbinData",JSON.stringify(d))}function flash(b){let o=b.textContent;b.textContent="‚úÖ";setTimeout(()=>b.textContent=o,700)}function styleBtn(b){b.style="background:rgba(255,255,255,0.6);border:1px solid rgba(255,255,255,0.3);border-radius:12px;padding:6px 14px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;font-size:14px;color:#007aff;box-shadow:0 2px 6px rgba(0,0,0,0.08);backdrop-filter:blur(6px);transition:all 0.2s ease;cursor:pointer";b.onpointerdown=()=>b.style.opacity="0.8";b.onpointerup=()=>b.style.opacity="1"}function copyToClipboard(t,b){let x=document.createElement("textarea");x.value=t;x.style.position="fixed";x.style.opacity=0;document.body.appendChild(x);x.focus();x.select();try{document.execCommand("copy");flash(b)}catch(e){alert("Copy failed")}document.body.removeChild(x)}function dragHandler(c){let y,t,d=false,lastY=0,velocity=0,lastTime=0;const snap=(to)=>{c.style.transition="top 0.25s ease-in-out";c.style.top=to;c.style.bottom="auto"};c.addEventListener("touchstart",e=>{c.style.transition="none";y=e.touches[0].clientY;t=c.getBoundingClientRect().top;d=true;lastTime=Date.now();lastY=y},{passive:true});c.addEventListener("touchmove",e=>{if(!d)return;let now=Date.now(),ny=e.touches[0].clientY,dt=now-lastTime;velocity=(ny-lastY)/dt;lastTime=now;lastY=ny;const delta=ny-y;c.style.top=`${t+delta}px`;c.style.bottom="auto"},{passive:true});c.addEventListener("touchend",()=>{d=false;const currentTop=c.getBoundingClientRect().top,mid=window.innerHeight/2;if(velocity<-.3||currentTop<mid){snap("12px")}else{c.style.transition="top 0.25s ease-in-out";c.style.top="auto";c.style.bottom="env(safe-area-inset-bottom,12px)"}})}function showTextareaModal(title,callback){let overlay=document.createElement("div");overlay.style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.4);z-index:99999;display:flex;align-items:center;justify-content:center";let box=document.createElement("div");box.style="background:rgba(255,255,255,0.8);backdrop-filter:blur(10px);padding:20px;border-radius:16px;max-width:90%;width:400px;display:flex;flex-direction:column;gap:10px;font-family:-apple-system,BlinkMacSystemFont,sans-serif";let label=document.createElement("div");label.textContent=title;label.style="font-weight:600;font-size:16px";let textarea=document.createElement("textarea");textarea.rows=10;textarea.style="width:100%;padding:10px;font-size:14px;border-radius:10px;border:1px solid #ccc;font-family:inherit";let save=document.createElement("button");save.textContent="‚úÖ Add";styleBtn(save);save.style.alignSelf="flex-end";save.onclick=function(){callback(textarea.value);document.body.removeChild(overlay)};box.appendChild(label);box.appendChild(textarea);box.appendChild(save);overlay.appendChild(box);document.body.appendChild(overlay)}function render(){if(window.__sbinContainer)document.body.removeChild(window.__sbinContainer);let c=document.createElement("div");window.__sbinOverlay=true;window.__sbinContainer=c;c.style="position:fixed;left:12px;right:12px;top:auto;bottom:env(safe-area-inset-bottom,12px);max-height:50vh;overflow:auto;background:rgba(255,255,255,0.6);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.3);border-radius:20px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,0.1);font-family:-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;display:flex;flex-wrap:wrap;gap:10px;align-items:flex-start;justify-content:space-between;z-index:9999;touch-action:none;";dragHandler(c);let r=document.createElement("div");r.style="display:flex;gap:10px;flex-wrap:wrap;flex:1 1 100%";if(view==="main"){if(editing){["s","b","i","n"].forEach(k=>{let ta=document.createElement("textarea");ta.id="sbin_"+k;ta.placeholder=k.toUpperCase();ta.value=active[k]||"";ta.style="flex:1;min-width:80px;height:60px;padding:10px;border:1px solid #ccc;border-radius:12px;font-size:14px;font-family:inherit";r.appendChild(ta)})}else{["s","b","i","n"].forEach(k=>{let btn=document.createElement("button");btn.textContent={s:"Situation",b:"Behavior",i:"Impact",n:"Next Steps"}[k];styleBtn(btn);btn.onclick=function(){copyToClipboard(active[k]||"",btn)};r.appendChild(btn)})}c.appendChild(r);let ctrl=document.createElement("div");ctrl.style="display:flex;gap:10px;flex-wrap:wrap;flex:1 1 100%;margin-top:12px";if(editing){let saveBtn=document.createElement("button");saveBtn.textContent="üíæ Save";styleBtn(saveBtn);saveBtn.style.background="#007aff";saveBtn.style.color="#fff";saveBtn.onclick=function(){["s","b","i","n"].forEach(k=>{active[k]=document.getElementById("sbin_"+k).value});d.topics[activeTopic]=active;editing=false;save();render()};ctrl.appendChild(saveBtn)}else{let edit=document.createElement("button");edit.textContent="‚úèÔ∏è Edit";styleBtn(edit);edit.onclick=function(){editing=true;render()};ctrl.appendChild(edit)}let name=document.createElement("button");name.textContent="üë• Names";styleBtn(name);name.onclick=function(){view="names";render()};ctrl.appendChild(name);let topic=document.createElement("button");topic.textContent="üóÇ Topics";styleBtn(topic);topic.onclick=function(){view="topics";render()};ctrl.appendChild(topic);let close=document.createElement("button");close.textContent="‚ùå";styleBtn(close);close.onclick=function(){document.body.removeChild(c);window.__sbinOverlay=false;window.__sbinContainer=null};ctrl.appendChild(close);c.appendChild(ctrl)}else if(view==="names"){let scrollWrap=document.createElement("div");scrollWrap.style="flex:1 1 100%;max-height:120px;overflow:hidden;position:relative";let list=document.createElement("div");list.style="display:grid;grid-template-columns:1fr 1fr;gap:10px;transition:transform 0.2s ease";let rowHeight=44;let visibleRows=3;let totalRows=Math.ceil(d.names.length/2);let maxOffset=Math.max(0,(totalRows-visibleRows)*rowHeight);list.style.transform=`translateY(${-nameScrollOffset}px)`;d.names.forEach((n,i)=>{let btn=document.createElement("button");btn.textContent=n;styleBtn(btn);btn.onclick=function(){copyToClipboard(n,btn)};list.appendChild(btn)});scrollWrap.appendChild(list);c.appendChild(scrollWrap);let scrollBtns=document.createElement("div");scrollBtns.style="display:flex;gap:10px;flex:1 1 100%;justify-content:center";["‚¨ÜÔ∏è","‚¨áÔ∏è"].forEach(dir=>{let btn=document.createElement("button");btn.textContent=dir;styleBtn(btn);btn.disabled=(dir==="‚¨ÜÔ∏è"&&nameScrollOffset<=0)||(dir==="‚¨áÔ∏è"&&nameScrollOffset>=maxOffset);btn.onclick=function(){let step=44;if(dir==="‚¨ÜÔ∏è")nameScrollOffset=Math.max(0,nameScrollOffset-step);else nameScrollOffset=Math.min(nameScrollOffset+step,maxOffset);render()};scrollBtns.appendChild(btn)});c.appendChild(scrollBtns);let ctrl=document.createElement("div");ctrl.style="display:flex;gap:10px;flex-wrap:wrap;flex:1 1 100%";let toggle=document.createElement("button");toggle.textContent=editNames?"üëÅ Hide Edit":"‚úèÔ∏è Edit Mode";styleBtn(toggle);toggle.onclick=function(){editNames=!editNames;render()};ctrl.appendChild(toggle);let add=document.createElement("button");add.textContent="‚ûï Add Name(s)";styleBtn(add);add.style.background="#007aff";add.style.color="#fff";add.onclick=function(){showTextareaModal("Enter names (one per line):",input=>{let names=input.split("\n").map(n=>n.trim()).filter(n=>n);d.names.push(...names);save();render()})};ctrl.appendChild(add);let back=document.createElement("button");back.textContent="‚¨ÖÔ∏è Main";styleBtn(back);back.onclick=function(){view="main";render()};ctrl.appendChild(back);c.appendChild(ctrl)}else if(view==="topics"){let list=document.createElement("div");list.style="flex:1 1 100%;display:flex;flex-wrap:wrap;gap:10px";Object.keys(d.topics).forEach(key=>{let btn=document.createElement("button");btn.textContent=key+(key===activeTopic?" ‚úÖ":"");styleBtn(btn);btn.onclick=function(){activeTopic=key;active=d.topics[key];d.activeTopic=key;save();view="main";render()};list.appendChild(btn)});c.appendChild(list);let add=document.createElement("button");add.textContent="‚ûï Add Topic";styleBtn(add);add.style.background="#007aff";add.style.color="#fff";add.onclick=function(){let name=prompt("New topic name:");if(name&&!d.topics[name]){d.topics[name]={s:"",b:"",i:"",n:""};activeTopic=name;active=d.topics[name];d.activeTopic=name;save();view="main";render()}};c.appendChild(add);let back=document.createElement("button");back.textContent="‚¨ÖÔ∏è Main";styleBtn(back);back.onclick=function(){view="main";render()};c.appendChild(back)}document.body.appendChild(c);window.addEventListener("resize",()=>{const a=document.activeElement;if(a&&a.tagName==="TEXTAREA"){setTimeout(()=>{a.scrollIntoView({behavior:"smooth",block:"center"})},150)}})}render()})();
