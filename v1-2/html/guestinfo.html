<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customer Info â€“ OSL Guest Portal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../css/dashboard.css" />
  <link rel="stylesheet" href="../css/guest-portal.css" />
  <style>
    body {
      margin: 0; 
      background: #121212;
      color: #e0e0e0;
      font-family: system-ui, sans-serif;
    }
    #stickyHeader {
      position: sticky;
      top: 0;
      background: rgba(30, 30, 30, 0.95);
      backdrop-filter: saturate(180%) blur(16px);
      padding: 12px 20px;
      display: flex;
      gap: 12px;
      align-items: center;
      z-index: 1000;
      border-bottom: 1px solid #444;
    }
    #stickyHeader button {
      background-color: #1e90ff;
      border: none;
      color: white;
      padding: 8px 14px;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    #stickyHeader button:hover {
      background-color: #4aa8ff;
    }
    #leadIdContainer {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }
    #leadIdText {
      user-select: all;
      background: #222;
      padding: 4px 10px;
      border-radius: 8px;
      font-family: monospace;
      display: none;
      max-width: 240px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #1e90ff;
    }
  </style>
</head>
<body>

  <header id="stickyHeader">
    <button id="btnNewLead">+ New Lead</button>
    <button id="btnDashboard" onclick="window.location.href='./admin.html'">Dashboard</button>

    <div id="leadIdContainer">
      <button id="btnToggleLeadId">See Lead ID</button>
      <span id="leadIdText">-</span>
    </div>
  </header>

  <div id="guestApp"></div> <!-- container JS will fill -->

  <!-- Firebase SDKs -->
  <script type="module" src="../js/gp-firebase.js"></script>
  <script type="module" src="../js/gp-app.js"></script>
  <script type="module" src="../js/ui-app.js"></script>

  <script>
    const btnToggleLeadId = document.getElementById('btnToggleLeadId');
    const leadIdText = document.getElementById('leadIdText');

    btnToggleLeadId.addEventListener('click', () => {
      if (leadIdText.style.display === 'inline-block') {
        leadIdText.style.display = 'none';
        btnToggleLeadId.textContent = 'See Lead ID';
      } else {
        leadIdText.style.display = 'inline-block';
        btnToggleLeadId.textContent = 'Hide Lead ID';
      }
    });

    // Assuming your gpApp exposes current lead id as gpApp.guestKey
    // Update lead id display on load and on changes
    function updateLeadIdDisplay() {
      const id = window.gpApp?.guestKey || '-';
      leadIdText.textContent = id;
    }

    // Hook the new lead button to gpApp.createNewLead or equivalent
    document.getElementById('btnNewLead').addEventListener('click', async () => {
      if (window.gpApp?.createNewLead) {
        await window.gpApp.createNewLead();
        updateLeadIdDisplay();
      } else {
        alert('New Lead function not available');
      }
    });

    // On page load update lead id
    window.addEventListener('load', () => {
      updateLeadIdDisplay();
    });
  </script>

</body>
</html>